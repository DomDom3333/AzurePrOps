<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:AzurePrOps.ViewModels"
        xmlns:model="using:AzurePrOps.AzureConnection.Models"
        x:Class="AzurePrOps.Views.PullRequestDetailsWindow"
        x:DataType="vm:PullRequestDetailsWindowViewModel"
        Title="Pull Request Details"
        Width="600"
        Height="650">
    <ScrollViewer Margin="10" VerticalScrollBarVisibility="Auto">
        <StackPanel Spacing="6">
            <TextBlock Text="{Binding PullRequest.Title}" FontWeight="Bold" FontSize="16"/>
            <StackPanel Orientation="Horizontal" Spacing="4">
                <TextBlock Text="ðŸ‘¤"/>
                <TextBlock Text="{Binding PullRequest.Creator}" FontStyle="Italic"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="4">
                <TextBlock Text="ðŸ“…"/>
                <TextBlock Text="{Binding PullRequest.Created}"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                <TextBlock Text="{Binding PullRequest.Status, Converter={StaticResource StatusToIcon}}"
                           Foreground="{Binding PullRequest.Status, Converter={StaticResource StatusToBrush}}"
                           FontSize="16"/>
                <TextBlock Text="{Binding PullRequest.Status}"
                           Foreground="{Binding PullRequest.Status, Converter={StaticResource StatusToBrush}}"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="4">
                <TextBlock Text="ðŸ”€"/>
                <TextBlock Text="{Binding PullRequest.SourceBranch, StringFormat='Source: {0}'}" TextWrapping="Wrap"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="4">
                <TextBlock Text="âž¡"/>
                <TextBlock Text="{Binding PullRequest.TargetBranch, StringFormat='Target: {0}'}" TextWrapping="Wrap"/>
            </StackPanel>

            <TextBlock Text="Participants" FontWeight="Bold" Margin="0,10,0,0"/>
            <ListBox ItemsSource="{Binding PullRequest.Reviewers}">
                <ListBox.ItemTemplate>
                    <DataTemplate x:DataType="model:ReviewerInfo">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <TextBlock Text="{Binding DisplayName}" FontWeight="Bold"/>
                            <TextBlock Text="({Binding Vote})" Foreground="Gray"/>
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <TextBlock Text="Comments" FontWeight="Bold" Margin="0,10,0,0"/>
            <ListBox ItemsSource="{Binding Comments}">
                <ListBox.ItemTemplate>
                    <DataTemplate x:DataType="model:PullRequestComment">
                        <StackPanel Margin="0,0,0,4">
                            <TextBlock Text="{Binding Author}" FontWeight="Bold"/>
                            <TextBlock Text="{Binding PostedDate}" FontStyle="Italic" FontSize="10"/>
                            <TextBlock Text="{Binding Content}" TextWrapping="Wrap"/>
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <TextBlock Text="Changes" FontWeight="Bold" Margin="0,10,0,0"/>
            <ListBox ItemsSource="{Binding FileDiffs}" Height="200">
                <ListBox.ItemTemplate>
                    <DataTemplate x:DataType="model:FileDiff">
                        <Expander Header="{Binding FilePath}" IsExpanded="False" Margin="0,0,0,4">
                            <ScrollViewer HorizontalScrollBarVisibility="Auto">
                                <TextBlock Text="{Binding Diff}" FontFamily="Consolas" FontSize="12"/>
                            </ScrollViewer>
                        </Expander>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <Button Content="Open in Browser"
                    Command="{Binding OpenInBrowserCommand}"
                    HorizontalAlignment="Right"
                    Width="150"
                    Margin="0,10,0,0"/>
        </StackPanel>
    </ScrollViewer>
</Window>
